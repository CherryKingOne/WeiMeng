# WeiMeng Agent 前端重构方案

## 一、当前项目问题分析

### 1. 目录结构问题

| 问题 | 描述 |
|------|------|
| **扁平化结构** | 所有页面组件直接放在 `app/` 目录下，没有按功能模块划分 |
| **组件缺失** | 仅有 `SettingsModal.tsx` 和 `SidebarLogo.tsx` 两个公共组件，缺乏组件分层 |
| **缺少基础设施** | 没有统一的 hooks、utils、types、constants、services 等目录 |
| **样式管理混乱** | 仅有 `globals.css`，大量样式散落在各组件中 |

### 2. 代码重复问题

```
问题示例：
├── dashboard/page.tsx    → 包含完整侧边栏代码 (~80行)
├── workflows/page.tsx    → 包含完整侧边栏代码 (~80行)  
├── projects/page.tsx     → 包含完整侧边栏代码 (~80行)
├── plugins/page.tsx      → 包含完整侧边栏代码 (~80行)
├── assets/page.tsx       → 包含完整侧边栏代码 (~80行)
├── scripts/page.tsx      → 包含完整侧边栏代码 (~80行)
└── 重复代码总计：约 480 行
```

**重复内容包括：**
- 侧边栏布局结构
- 导航菜单 SVG 图标
- 设置按钮和模态框触发逻辑
- 页面头部布局

### 3. 组件设计问题

| 文件 | 行数 | 问题 |
|------|------|------|
| `workflow-editor/page.tsx` | 705 行 | 单文件过于庞大，应拆分为多个子组件 |
| `plugins/page.tsx` | 441+ 行 | 包含数据定义、UI 组件、业务逻辑 |
| `assets/page.tsx` | 516+ 行 | 混合了数据、组件、样式 |
| `scripts/page.tsx` | 697+ 行 | 包含独立模态框组件定义 |

**核心问题：**
- 页面组件承担了过多职责
- UI 组件与业务逻辑未分离
- 缺乏可复用的基础组件库

### 4. 类型定义问题

```typescript
// 类型定义散落在各文件中：
// plugins/page.tsx
interface Plugin { id: string; name: string; ... }

// assets/page.tsx  
interface Asset { id: string; type: string; ... }

// scripts/page.tsx
interface Script { id: string; title: string; ... }

// workflow-editor/page.tsx
type NodeType = 'media' | 'video' | 'text' | 'gen' | ...
interface NodeData { id: string; type: NodeType; ... }
```

### 5. 状态管理问题

- 无全局状态管理方案
- 用户信息、主题设置等跨页面状态无法共享
- 每个页面独立管理本地状态

### 6. API 调用问题

```typescript
// API 调用直接写在组件中，缺乏统一管理
// login/page.tsx
const apiUrl = process.env.NEXT_PUBLIC_API_URL || "http://0.0.0.0:5607/api/v1";
const response = await fetch(`${apiUrl}/auth/login`, { ... });

// signup/page.tsx  
const apiUrl = process.env.NEXT_PUBLIC_API_URL || "http://0.0.0.0:5607/api/v1";
const res = await fetch(`${apiUrl}/captcha/email/send`, { ... });
```

### 7. 样式管理问题

- 大量内联 Tailwind 类名
- 相同样式模式在多处重复
- 缺乏统一的主题变量和设计令牌

---

## 二、模块化目录结构设计

```
frontend/
├── app/                          # Next.js App Router
│   ├── (auth)/                   # 认证相关页面组
│   │   ├── login/
│   │   │   └── page.tsx
│   │   ├── signup/
│   │   │   └── page.tsx
│   │   ├── forgot-password/
│   │   │   └── page.tsx
│   │   └── layout.tsx            # 认证页面共享布局
│   │
│   ├── (dashboard)/              # 仪表盘相关页面组
│   │   ├── dashboard/
│   │   │   └── page.tsx
│   │   ├── projects/
│   │   │   └── page.tsx
│   │   ├── workflows/
│   │   │   └── page.tsx
│   │   ├── workflow-editor/
│   │   │   └── page.tsx
│   │   ├── assets/
│   │   │   └── page.tsx
│   │   ├── scripts/
│   │   │   └── page.tsx
│   │   ├── plugins/
│   │   │   └── page.tsx
│   │   ├── design/
│   │   │   └── page.tsx
│   │   └── layout.tsx            # 仪表盘共享布局（含侧边栏）
│   │
│   ├── globals.css
│   ├── layout.tsx
│   └── page.tsx
│
├── components/                   # 组件库
│   ├── ui/                       # 基础 UI 组件
│   │   ├── Button/
│   │   │   ├── Button.tsx
│   │   │   ├── Button.styles.ts
│   │   │   └── index.ts
│   │   ├── Input/
│   │   │   ├── Input.tsx
│   │   │   └── index.ts
│   │   ├── Modal/
│   │   │   ├── Modal.tsx
│   │   │   └── index.ts
│   │   ├── Drawer/
│   │   │   ├── Drawer.tsx
│   │   │   └── index.ts
│   │   ├── Card/
│   │   │   ├── Card.tsx
│   │   │   └── index.ts
│   │   ├── Badge/
│   │   │   ├── Badge.tsx
│   │   │   └── index.ts
│   │   ├── Avatar/
│   │   │   ├── Avatar.tsx
│   │   │   └── index.ts
│   │   ├── Tooltip/
│   │   │   ├── Tooltip.tsx
│   │   │   └── index.ts
│   │   ├── Dropdown/
│   │   │   ├── Dropdown.tsx
│   │   │   └── index.ts
│   │   ├── Tabs/
│   │   │   ├── Tabs.tsx
│   │   │   └── index.ts
│   │   ├── SearchInput/
│   │   │   ├── SearchInput.tsx
│   │   │   └── index.ts
│   │   ├── Toggle/
│   │   │   ├── Toggle.tsx
│   │   │   └── index.ts
│   │   ├── Skeleton/
│   │   │   ├── Skeleton.tsx
│   │   │   └── index.ts
│   │   └── index.ts              # 统一导出
│   │
│   ├── layout/                   # 布局组件
│   │   ├── Sidebar/
│   │   │   ├── Sidebar.tsx
│   │   │   ├── SidebarNav.tsx
│   │   │   ├── SidebarNavItem.tsx
│   │   │   ├── SidebarLogo.tsx
│   │   │   └── index.ts
│   │   ├── Header/
│   │   │   ├── Header.tsx
│   │   │   └── index.ts
│   │   ├── PageContainer/
│   │   │   ├── PageContainer.tsx
│   │   │   └── index.ts
│   │   └── index.ts
│   │
│   ├── features/                 # 功能组件（业务相关）
│   │   ├── auth/
│   │   │   ├── LoginForm.tsx
│   │   │   ├── SignupForm.tsx
│   │   │   └── index.ts
│   │   ├── settings/
│   │   │   ├── SettingsModal.tsx
│   │   │   ├── SettingsGeneral.tsx
│   │   │   ├── SettingsAccount.tsx
│   │   │   ├── SettingsApi.tsx
│   │   │   ├── SettingsAbout.tsx
│   │   │   └── index.ts
│   │   ├── workflow/
│   │   │   ├── WorkflowCard.tsx
│   │   │   ├── WorkflowGrid.tsx
│   │   │   ├── WorkflowEditor/
│   │   │   │   ├── Canvas.tsx
│   │   │   │   ├── NodePanel.tsx
│   │   │   │   ├── NodeRenderer.tsx
│   │   │   │   ├── MediaNode.tsx
│   │   │   │   ├── TextNode.tsx
│   │   │   │   ├── GenNode.tsx
│   │   │   │   ├── ConnectionLine.tsx
│   │   │   │   └── index.ts
│   │   │   └── index.ts
│   │   ├── project/
│   │   │   ├── ProjectCard.tsx
│   │   │   ├── ProjectGrid.tsx
│   │   │   ├── FolderCard.tsx
│   │   │   ├── ContextMenu.tsx
│   │   │   └── index.ts
│   │   ├── asset/
│   │   │   ├── AssetCard.tsx
│   │   │   ├── AssetGrid.tsx
│   │   │   ├── AssetDetailDrawer.tsx
│   │   │   ├── AssetFilterBar.tsx
│   │   │   ├── CreateAssetModal.tsx
│   │   │   └── index.ts
│   │   ├── script/
│   │   │   ├── ScriptCard.tsx
│   │   │   ├── ScriptGrid.tsx
│   │   │   ├── ImportModal.tsx
│   │   │   ├── StatusBadge.tsx
│   │   │   └── index.ts
│   │   ├── plugin/
│   │   │   ├── PluginCard.tsx
│   │   │   ├── PluginGrid.tsx
│   │   │   ├── PluginConfigDrawer.tsx
│   │   │   ├── FeaturedBanner.tsx
│   │   │   └── index.ts
│   │   ├── design/
│   │   │   ├── ToolSidebar.tsx
│   │   │   ├── Canvas.tsx
│   │   │   ├── ChatPanel.tsx
│   │   │   ├── ExportMenu.tsx
│   │   │   └── index.ts
│   │   └── index.ts
│   │
│   └── icons/                    # 图标组件
│       ├── NavIcons.tsx
│       ├── ToolIcons.tsx
│       └── index.ts
│
├── hooks/                        # 自定义 Hooks
│   ├── useAuth.ts
│   ├── useModal.ts
│   ├── useDrawer.ts
│   ├── useLocalStorage.ts
│   ├── useClickOutside.ts
│   ├── useDragAndDrop.ts
│   ├── useDebounce.ts
│   └── index.ts
│
├── services/                     # API 服务层
│   ├── api.ts                    # Axios 实例配置
│   ├── auth.service.ts
│   ├── project.service.ts
│   ├── workflow.service.ts
│   ├── asset.service.ts
│   ├── script.service.ts
│   ├── plugin.service.ts
│   └── index.ts
│
├── stores/                       # 状态管理
│   ├── auth.store.ts
│   ├── user.store.ts
│   ├── settings.store.ts
│   ├── workflow.store.ts
│   └── index.ts
│
├── types/                        # 类型定义
│   ├── auth.types.ts
│   ├── user.types.ts
│   ├── project.types.ts
│   ├── workflow.types.ts
│   ├── asset.types.ts
│   ├── script.types.ts
│   ├── plugin.types.ts
│   ├── api.types.ts
│   └── index.ts
│
├── constants/                    # 常量定义
│   ├── routes.ts
│   ├── api.ts
│   ├── storage.ts
│   └── index.ts
│
├── utils/                        # 工具函数
│   ├── format.ts
│   ├── validation.ts
│   ├── storage.ts
│   ├── cn.ts                     # classnames 工具
│   └── index.ts
│
├── styles/                       # 样式文件
│   ├── variables.css
│   ├── animations.css
│   └── components.css
│
├── config/                       # 配置文件
│   ├── navigation.ts
│   └── theme.ts
│
├── public/                       # 静态资源
│   └── logo/
│
├── .env.local
├── .env.example
├── next.config.ts
├── tailwind.config.ts
├── tsconfig.json
└── package.json
```

---

## 三、核心模块详细设计

### 1. 布局组件设计

#### Sidebar 组件拆分

```typescript
// components/layout/Sidebar/Sidebar.tsx
interface SidebarProps {
  children?: React.ReactNode;
}

export function Sidebar({ children }: SidebarProps) {
  return (
    <aside className="w-64 bg-[#F9FAFB] border-r border-gray-100 flex flex-col">
      <SidebarLogo />
      <SidebarNav />
      {children}
      <SidebarFooter />
    </aside>
  );
}

// components/layout/Sidebar/SidebarNav.tsx
import { NAV_ITEMS } from '@/config/navigation';

export function SidebarNav() {
  return (
    <nav className="flex-1 px-4 space-y-1">
      {NAV_ITEMS.map((section) => (
        <div key={section.title}>
          <NavSection title={section.title} />
          {section.items.map((item) => (
            <SidebarNavItem key={item.href} {...item} />
          ))}
        </div>
      ))}
    </nav>
  );
}

// components/layout/Sidebar/SidebarNavItem.tsx
interface SidebarNavItemProps {
  href: string;
  icon: React.ReactNode;
  label: string;
  isActive?: boolean;
}

export function SidebarNavItem({ href, icon, label, isActive }: SidebarNavItemProps) {
  return (
    <Link 
      href={href}
      className={cn(
        "flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-colors",
        isActive ? "bg-black text-white" : "text-gray-600 hover:bg-gray-100"
      )}
    >
      {icon}
      {label}
    </Link>
  );
}
```

#### 导航配置文件

```typescript
// config/navigation.ts
import { 
  HomeIcon, FolderIcon, BoltIcon, 
  ImageIcon, DocumentIcon, PuzzleIcon 
} from '@/components/icons';

export const NAV_ITEMS = [
  {
    title: '主要功能',
    items: [
      { href: '/dashboard', label: '首页', icon: <HomeIcon /> },
      { href: '/projects', label: '项目', icon: <FolderIcon /> },
      { href: '/workflows', label: '工作流', icon: <BoltIcon /> },
    ]
  },
  {
    title: '资源中心',
    items: [
      { href: '/assets', label: '资产', icon: <ImageIcon /> },
      { href: '/scripts', label: '剧本', icon: <DocumentIcon /> },
      { href: '/plugins', label: '插件', icon: <PuzzleIcon /> },
    ]
  }
];
```

### 2. 仪表盘布局设计

```typescript
// app/(dashboard)/layout.tsx
import { Sidebar } from '@/components/layout/Sidebar';
import { SettingsModal } from '@/components/features/settings';
import { useSettingsStore } from '@/stores';

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const { isSettingsOpen, closeSettings } = useSettingsStore();

  return (
    <div className="flex h-screen bg-white text-gray-900 font-sans">
      <Sidebar />
      <SettingsModal isOpen={isSettingsOpen} onClose={closeSettings} />
      <main className="flex-1 overflow-y-auto">
        {children}
      </main>
    </div>
  );
}
```

### 3. API 服务层设计

```typescript
// services/api.ts
import axios from 'axios';

const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://0.0.0.0:5607/api/v1';

export const api = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 请求拦截器
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // 处理未授权
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

// services/auth.service.ts
import { api } from './api';
import { LoginRequest, LoginResponse, SignupRequest } from '@/types';

export const authService = {
  login: async (data: LoginRequest): Promise<LoginResponse> => {
    const response = await api.post('/auth/login', data);
    return response.data;
  },

  register: async (data: SignupRequest): Promise<void> => {
    await api.post('/auth/register', data);
  },

  sendCaptcha: async (email: string): Promise<void> => {
    await api.post('/captcha/email/send', { email });
  },
};
```

### 4. 状态管理设计

```typescript
// stores/settings.store.ts
import { create } from 'zustand';

interface SettingsState {
  isOpen: boolean;
  activeTab: string;
  theme: 'light' | 'dark' | 'auto';
  language: string;
  openSettings: () => void;
  closeSettings: () => void;
  setActiveTab: (tab: string) => void;
  setTheme: (theme: 'light' | 'dark' | 'auto') => void;
  setLanguage: (lang: string) => void;
}

export const useSettingsStore = create<SettingsState>((set) => ({
  isOpen: false,
  activeTab: 'general',
  theme: 'light',
  language: 'zh',
  openSettings: () => set({ isOpen: true }),
  closeSettings: () => set({ isOpen: false }),
  setActiveTab: (tab) => set({ activeTab: tab }),
  setTheme: (theme) => set({ theme }),
  setLanguage: (lang) => set({ language: lang }),
}));

// stores/auth.store.ts
import { create } from 'zustand';
import { User } from '@/types';

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  setUser: (user: User | null) => void;
  setToken: (token: string | null) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  token: typeof window !== 'undefined' ? localStorage.getItem('token') : null,
  isAuthenticated: false,
  setUser: (user) => set({ user, isAuthenticated: !!user }),
  setToken: (token) => {
    if (token) {
      localStorage.setItem('token', token);
    } else {
      localStorage.removeItem('token');
    }
    set({ token, isAuthenticated: !!token });
  },
  logout: () => {
    localStorage.removeItem('token');
    set({ user: null, token: null, isAuthenticated: false });
  },
}));
```

### 5. 类型定义设计

```typescript
// types/workflow.types.ts
export type NodeType = 'media' | 'video' | 'text' | 'gen' | 'videogen' | 'post' | 'upscale' | 'controlnet';

export interface NodeData {
  id: string;
  type: NodeType;
  x: number;
  y: number;
  label?: string;
  content?: string;
  image?: string;
}

export interface Workflow {
  id: string;
  name: string;
  status: 'draft' | 'running' | 'published' | 'template';
  lastEdited: string;
  collaborators: string[];
}

// types/plugin.types.ts
export interface Plugin {
  id: string;
  name: string;
  description: string;
  category: PluginCategory;
  rating: number;
  downloads: string;
  installed: boolean;
  active: boolean;
  iconGradient: string;
  iconPath: React.ReactNode;
}

export type PluginCategory = '模型训练' | '图像生成' | '工具增强' | '工作流';

// types/asset.types.ts
export interface Asset {
  id: string;
  type: AssetType;
  title: string;
  creator: string;
  date: string;
  prompt: string;
  imageGradient: string;
  imageUrl?: string;
  params: AssetParams;
}

export type AssetType = 'image' | '3d' | 'video' | 'favorite';

export interface AssetParams {
  model: string;
  seed: string;
  steps: string;
  cfgScale: string;
}
```

### 6. 基础 UI 组件设计

```typescript
// components/ui/Button/Button.tsx
import { cn } from '@/utils/cn';

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'ghost' | 'danger';
  size?: 'sm' | 'md' | 'lg';
  loading?: boolean;
}

export function Button({
  children,
  variant = 'primary',
  size = 'md',
  loading = false,
  className,
  disabled,
  ...props
}: ButtonProps) {
  const baseStyles = 'font-medium rounded-xl transition-all duration-200 flex items-center justify-center';
  
  const variants = {
    primary: 'bg-black text-white hover:bg-gray-800',
    secondary: 'bg-gray-100 text-gray-900 hover:bg-gray-200',
    ghost: 'bg-transparent text-gray-600 hover:bg-gray-100',
    danger: 'bg-red-500 text-white hover:bg-red-600',
  };

  const sizes = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-sm',
    lg: 'px-6 py-3 text-base',
  };

  return (
    <button
      className={cn(baseStyles, variants[variant], sizes[size], className)}
      disabled={disabled || loading}
      {...props}
    >
      {loading ? <LoadingSpinner /> : children}
    </button>
  );
}

// components/ui/Drawer/Drawer.tsx
interface DrawerProps {
  isOpen: boolean;
  onClose: () => void;
  title?: string;
  children: React.ReactNode;
  width?: string;
}

export function Drawer({ isOpen, onClose, title, children, width = '400px' }: DrawerProps) {
  return (
    <>
      {/* Overlay */}
      <div
        className={cn(
          "fixed inset-0 bg-black/20 backdrop-blur-sm z-40 transition-opacity duration-300",
          isOpen ? "opacity-100" : "opacity-0 pointer-events-none"
        )}
        onClick={onClose}
      />
      
      {/* Panel */}
      <div
        className={cn(
          "fixed right-0 top-0 h-full bg-white shadow-[-8px_0_30px_rgba(0,0,0,0.08)]",
          "transform transition-transform duration-300 z-50",
          isOpen ? "translate-x-0" : "translate-x-full"
        )}
        style={{ width }}
      >
        {title && (
          <div className="flex items-center justify-between p-6 border-b border-gray-100">
            <h2 className="text-lg font-semibold text-gray-900">{title}</h2>
            <button onClick={onClose} className="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100">
              <CloseIcon />
            </button>
          </div>
        )}
        <div className="flex-1 overflow-y-auto">{children}</div>
      </div>
    </>
  );
}
```

### 7. 自定义 Hooks 设计

```typescript
// hooks/useModal.ts
import { useState, useCallback } from 'react';

export function useModal(initialState = false) {
  const [isOpen, setIsOpen] = useState(initialState);

  const open = useCallback(() => setIsOpen(true), []);
  const close = useCallback(() => setIsOpen(false), []);
  const toggle = useCallback(() => setIsOpen((prev) => !prev), []);

  return { isOpen, open, close, toggle };
}

// hooks/useDrawer.ts
export function useDrawer(initialState = false) {
  return useModal(initialState);
}

// hooks/useClickOutside.ts
import { useEffect, useRef } from 'react';

export function useClickOutside(callback: () => void) {
  const ref = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleClick = (event: MouseEvent) => {
      if (ref.current && !ref.current.contains(event.target as Node)) {
        callback();
      }
    };

    document.addEventListener('click', handleClick);
    return () => document.removeEventListener('click', handleClick);
  }, [callback]);

  return ref;
}

// hooks/useDebounce.ts
import { useState, useEffect } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const timer = setTimeout(() => setDebouncedValue(value), delay);
    return () => clearTimeout(timer);
  }, [value, delay]);

  return debouncedValue;
}
```

---

## 四、重构实施计划

### 阶段一：基础设施搭建（优先级：高）

| 任务 | 描述 | 预估工作量 |
|------|------|-----------|
| 创建目录结构 | 按新设计创建所有目录 | 0.5 天 |
| 配置状态管理 | 安装 zustand，创建基础 store | 0.5 天 |
| 配置 API 服务层 | 创建 axios 实例和拦截器 | 0.5 天 |
| 创建类型定义 | 迁移并整理所有类型 | 1 天 |
| 创建工具函数 | cn、format、validation 等 | 0.5 天 |

### 阶段二：布局组件重构（优先级：高）

| 任务 | 描述 | 预估工作量 |
|------|------|-----------|
| 创建 Sidebar 组件 | 拆分为 Sidebar, SidebarNav, SidebarNavItem | 1 天 |
| 创建导航配置 | 将导航数据抽离到配置文件 | 0.5 天 |
| 创建 Dashboard Layout | 创建共享布局组件 | 0.5 天 |
| 创建 Auth Layout | 创建认证页面共享布局 | 0.5 天 |

### 阶段三：基础 UI 组件库（优先级：中）

| 任务 | 描述 | 预估工作量 |
|------|------|-----------|
| Button 组件 | 支持多种变体和尺寸 | 0.5 天 |
| Input 组件 | 支持前缀/后缀图标 | 0.5 天 |
| Modal 组件 | 通用模态框 | 0.5 天 |
| Drawer 组件 | 侧边抽屉 | 0.5 天 |
| Card 组件 | 卡片容器 | 0.5 天 |
| Badge 组件 | 状态标签 | 0.25 天 |
| Avatar 组件 | 用户头像 | 0.25 天 |
| SearchInput 组件 | 搜索输入框 | 0.25 天 |
| Toggle 组件 | 开关切换 | 0.25 天 |

### 阶段四：功能组件重构（优先级：中）

| 任务 | 描述 | 预估工作量 |
|------|------|-----------|
| Settings 模块 | 拆分设置模态框为多个子组件 | 1 天 |
| Workflow 模块 | 拆分工作流编辑器为多个节点组件 | 2 天 |
| Project 模块 | 创建项目卡片、文件夹卡片等 | 1 天 |
| Asset 模块 | 创建资产卡片、详情抽屉等 | 1 天 |
| Script 模块 | 创建剧本卡片、导入模态框等 | 1 天 |
| Plugin 模块 | 创建插件卡片、配置抽屉等 | 1 天 |
| Design 模块 | 创建设计页面各面板组件 | 1.5 天 |

### 阶段五：页面简化（优先级：中）

| 任务 | 描述 | 预估工作量 |
|------|------|-----------|
| Dashboard 页面 | 使用新组件重构 | 0.5 天 |
| Projects 页面 | 使用新组件重构 | 0.5 天 |
| Workflows 页面 | 使用新组件重构 | 0.5 天 |
| Workflow Editor 页面 | 使用新组件重构 | 1 天 |
| Assets 页面 | 使用新组件重构 | 0.5 天 |
| Scripts 页面 | 使用新组件重构 | 0.5 天 |
| Plugins 页面 | 使用新组件重构 | 0.5 天 |
| Design 页面 | 使用新组件重构 | 0.5 天 |
| Auth 页面 | 使用新组件重构 | 0.5 天 |

### 阶段六：测试与优化（优先级：低）

| 任务 | 描述 | 预估工作量 |
|------|------|-----------|
| 单元测试 | 为核心组件添加测试 | 2 天 |
| 集成测试 | 为关键流程添加测试 | 1 天 |
| 性能优化 | 代码分割、懒加载优化 | 1 天 |
| 文档完善 | 组件使用文档 | 1 天 |

---

## 五、技术选型建议

### 状态管理
- **推荐：Zustand** - 轻量、简单、TypeScript 友好
- 备选：Jotai、Redux Toolkit

### HTTP 客户端
- **推荐：Axios** - 功能完善，拦截器支持好
- 备选：Ky、fetch 原生封装

### UI 组件库（可选）
- **不推荐引入完整 UI 库** - 当前设计风格已确定
- 可参考：Radix UI（无样式组件）、Headless UI

### 工具库
- **clsx + tailwind-merge** - 类名合并
- **date-fns** - 日期处理
- **zod** - 表单验证

---

## 六、注意事项

### 重构原则
1. **渐进式重构** - 逐步迁移，保持系统可用
2. **保持向后兼容** - 旧代码可与新代码共存
3. **测试先行** - 重构前确保有测试覆盖
4. **文档同步** - 更新相关文档

### 代码规范
1. 组件命名：PascalCase
2. 文件命名：PascalCase（组件）、camelCase（工具）
3. 目录命名：kebab-case
4. 导出方式：统一使用命名导出

### Git 工作流
1. 每个阶段创建独立分支
2. 小步提交，便于回滚
3. 提交信息遵循 Conventional Commits

---

## 七、预期收益

| 指标 | 当前状态 | 重构后预期 |
|------|----------|-----------|
| 代码重复率 | ~30% | <5% |
| 组件复用性 | 低 | 高 |
| 类型安全性 | 部分 | 完整 |
| 开发效率 | 中 | 高 |
| 维护成本 | 高 | 低 |
| 新功能开发 | 慢 | 快 |

---

*文档版本：v1.0*
*创建日期：2025-02-13*
*待审核通过后执行*
